
<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Flow Viewer (หลัก – แก้บั๊ก 5 flows)</title>
<style>
 *{box-sizing:border-box}
 body{margin:0;font-family:Segoe UI,Tahoma,Arial,Helvetica,"Noto Sans Thai",sans-serif;color:#e5e7eb;background:#0f172a}
 header{padding:12px 20px;border-bottom:1px solid #1f2937}
 .layout{display:grid;grid-template-columns:260px 1fr;height:calc(100vh - 56px)}
 .left{background:#111827;border-right:1px solid #1f2937;padding:10px}
 .menu h2{font-size:14px;margin:8px 0 4px;opacity:.85}
 .menu button{width:100%;text-align:left;padding:8px 10px;margin:6px 0;border:1px solid #1f2937;border-radius:6px;background:#0b1220;color:#e5e7eb;cursor:pointer}
 .menu button.active{border-color:#22d3ee}
 .legend{margin-top:10px;padding-top:8px;border-top:1px dashed #1f2937;font-size:12px}
 .right{position:relative}
 #diagram{width:100%;height:100%;background:#0a0f1a}
 .node rect{rx:6;ry:6;fill:transparent;stroke-width:1.6}
 .node.core rect{stroke:#22d3ee}
 .node.new rect{stroke:#60a5fa}
 .node.legacy rect{stroke:#f59e0b}
 .node.integration rect{stroke:#9ca3af}
 .node text{font-size:12px;fill:#e5e7eb}
 .link{stroke:#94a3b8;stroke-width:1.4;marker-end:url(#arrow)}
</style>
</head>
<body>
<header>
  <h1 style="font-size:18px;margin:0">Flow Viewer (หลัก – 5 flows)</h1>
  <div style="opacity:.8;font-size:13px">ระบบที่เหมือนกันใช้ตำแหน่งเดียวกันข้ามทุก Flow</div>
</header>
<div class="layout">
  <aside class="left">
    <div class="menu">
      <h2>รายการ Flow</h2>
      <button class="active" data-flow="SALES">SALES DATA FLOW</button>
      <button data-flow="PROMOTION">PROMOTION</button>
      <button data-flow="STOCK">STOCK ADJUSTMENT</button>
      <button data-flow="ITEM_MASTER">ITEM MASTER</button>
      <button data-flow="PO_TRANSFER">PO/Transfer (DTS/DTW/PBL/PBS)</button>
      <div class="legend">Core = ฟ้าคราม, New = น้ำเงิน, Legacy = เหลือง, Integration = เทา</div>
    </div>
  </aside>
  <main class="right">
    <svg id="diagram" viewBox="0 0 1200 800" preserveAspectRatio="xMidYMid meet">
      <defs>
        <marker id="arrow" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="10" markerHeight="7" orient="auto">
          <path d="M0,0 L10,5 L0,10 z" fill="#94a3b8"/>
        </marker>
      </defs>
    </svg>
  </main>
</div>
<script>
const shared = {
  SOA:{x:560,y:320,w:90,h:40,type:'core',label:'SOA'},
  RMS19:{x:720,y:320,w:110,h:50,type:'core',label:'RMS 19'},
  AZURE:{x:900,y:200,w:100,h:50,type:'core',label:'Azure'},
  SMARTSOFT:{x:560,y:80,w:120,h:48,type:'new',label:'SmartSoft'},
  STORELINE:{x:720,y:220,w:110,h:50,type:'legacy',label:'Storeline'},
  MAGENTO:{x:900,y:420,w:110,h:50,type:'new',label:'Magento'}
};

const flows={
  SALES:{title:'Sales',nodes:[
    {id:'POS_SL',label:'Store Line POS',x:140,y:260,w:140,h:50,type:'legacy'},
    {id:'POS_R10',label:'R10 POS',x:140,y:340,w:120,h:50,type:'legacy'},
    {id:'SSIS',label:'SSIS',x:330,y:200,w:90,h:44,type:'integration'},
    {id:'IL',label:'IL',x:330,y:260,w:80,h:40,type:'integration'},
    {id:'RTS',label:'RTS',x:330,y:320,w:90,h:44,type:'integration'},
    {id:'RESA19',label:'RESA 19',x:560,y:200,w:110,h:50,type:'new'},
    {id:'SIM',label:'SIM',x:560,y:420,w:80,h:42,type:'new'},
    {id:'RPMODI',label:'RPM ODI',x:900,y:340,w:110,h:46,type:'integration'},
    {id:'ERP',label:'ERP',x:1060,y:380,w:90,h:50,type:'legacy'},
    {id:'SMARTSOFT'}],
    links:[['POS_SL','SSIS'],['SSIS','IL'],['IL','RTS'],['RTS','SOA'],['SOA','RESA19'],['SOA','SIM'],['SIM','RMS19'],['RMS19','RPMODI'],['RPMODI','AZURE'],['SMARTSOFT','SOA'],['SOA','RMS19'],['SOA','AZURE'],['AZURE','ERP']]
  },
  PROMOTION:{title:'Promotion',nodes:[
    {id:'PROMO_1P',label:'1P (Promotion)',x:140,y:200,w:150,h:50,type:'legacy'},
    {id:'EXCEL',label:'Excel Upload',x:140,y:280,w:130,h:46,type:'legacy'},
    {id:'SOA_MFT',label:'SOA-MFT',x:330,y:220,w:110,h:46,type:'integration'},
    {id:'OPRM',label:'OPRM v19',x:330,y:300,w:120,h:50,type:'new'},
    {id:'SSIS_P',label:'SSIS',x:330,y:380,w:90,h:44,type:'integration'},
    {id:'IL_P',label:'IL',x:480,y:260,w:90,h:44,type:'integration'},
    {id:'STORELINE'},{id:'MAGENTO'},{id:'SMARTSOFT'}],
    links:[['PROMO_1P','SOA_MFT'],['EXCEL','SOA_MFT'],['SOA_MFT','OPRM'],['OPRM','IL_P'],['IL_P','SOA'],['SOA','STORELINE'],['SOA','MAGENTO'],['SMARTSOFT','SOA'],['SMARTSOFT','AZURE'],['IL_P','AZURE'],['SOA','RMS19'],['SOA','AZURE']]
  },
  STOCK:{title:'Stock',nodes:[
    {id:'STORE_R10',label:'Storeline / R10',x:140,y:260,w:150,h:50,type:'legacy'},
    {id:'IL_TSE',label:'IL (TSE)',x:330,y:260,w:110,h:46,type:'integration'},
    {id:'SIMV16',label:'SIM v16',x:560,y:220,w:110,h:50,type:'new'},
    {id:'RIB',label:'RIB',x:560,y:420,w:80,h:42,type:'integration'},
    {id:'ADAPTER',label:'Adapter',x:900,y:480,w:110,h:50,type:'integration'},
    {id:'WMS12',label:'WMS12',x:1060,y:480,w:90,h:50,type:'legacy'},
    {id:'DTH',label:'DTH',x:900,y:560,w:90,h:44,type:'legacy'},
    {id:'STORELINE'}],
    links:[['STORE_R10','IL_TSE'],['IL_TSE','SOA'],['SOA','SIMV16'],['SIMV16','RMS19'],['RIB','RMS19'],['RMS19','ADAPTER'],['ADAPTER','WMS12'],['ADAPTER','DTH'],['RMS19','AZURE'],['SOA','RMS19'],['SOA','AZURE']]
  },
  ITEM_MASTER:{title:'Item',nodes:[
    {id:'EIM',label:'EIM',x:140,y:220,w:80,h:44,type:'new'},
    {id:'EXCEL_IM',label:'Excel Upload',x:140,y:300,w:130,h:46,type:'legacy'},
    {id:'ADAPTER_IM',label:'Adapter',x:480,y:420,w:100,h:46,type:'integration'},
    {id:'STORELINE'},{id:'MAGENTO'},
    {id:'SESSIONM',label:'SessionM',x:900,y:120,w:110,h:50,type:'new'},
    {id:'CDP',label:'CDP',x:720,y:80,w:90,h:44,type:'new'},
    {id:'HIGHJUMP',label:'HighJump',x:720,y:420,w:110,h:50,type:'legacy'}],
    links:[['EIM','SOA'],['EXCEL_IM','SOA'],['SOA','STORELINE'],['SOA','ADAPTER_IM'],['ADAPTER_IM','RMS19'],['RMS19','AZURE'],['SOA','MAGENTO'],['SOA','SESSIONM'],['SOA','CDP'],['SOA','HIGHJUMP'],['SOA','RMS19'],['SOA','AZURE']]
  },
  PO_TRANSFER:{title:'PO/Transfer',nodes:[
    {id:'SUPPLIER',label:'Supplier (CSV/Excel)',x:140,y:120,w:150,h:50,type:'legacy'},
    {id:'TMS',label:'TMS',x:330,y:140,w:110,h:50,type:'new'},
    {id:'ORIM',label:'ORIM',x:1060,y:140,w:110,h:50,type:'new'},
    {id:'ORWMS',label:'ORWMS',x:900,y:220,w:110,h:50,type:'new'},
    {id:'SOA_DTH',label:'SOA-DTH',x:780,y:300,w:110,h:46,type:'integration'},
    {id:'WEB_ORDER',label:'Web Ordering',x:330,y:260,w:130,h:50,type:'new'},
    {id:'BY_FNR',label:'BY FnR',x:330,y:340,w:110,h:50,type:'new'},
    {id:'ORMS_ORFM',label:'ORMS / ORFM',x:560,y:260,w:140,h:52,type:'new'},
    {id:'HUB_SPOKE',label:'Hub & Spoke',x:330,y:440,w:120,h:50,type:'legacy'},
    {id:'SOA_MID',label:'SOA',x:480,y:260,w:70,h:40,type:'core'},
    {id:'SOADM1',label:'SOADM1',x:560,y:140,w:110,h:46,type:'integration'},
    {id:'SOADMTH',label:'SOAD TH',x:900,y:120,w:110,h:46,type:'integration'},
    {id:'RIB_ADP',label:'RIB/ODI/TH Adapter',x:780,y:200,w:150,h:46,type:'integration'},
    {id:'STORELINE'},{id:'AZURE'}],
    links:[['SUPPLIER','TMS'],['TMS','ORWMS'],['ORWMS','STORELINE'],['STORELINE','ORIM'],['WEB_ORDER','SOA_MID'],['BY_FNR','SOA_MID'],['SOA_MID','ORMS_ORFM'],['ORMS_ORFM','SOADM1'],['SOADM1','AZURE'],['ORMS_ORFM','RIB_ADP'],['RIB_ADP','SOA_DTH'],['SOA_DTH','ORWMS'],['HUB_SPOKE','BY_FNR']]
  }
};

const svg=document.getElementById('diagram');
function clearSVG(){while(svg.lastChild && svg.lastChild.tagName!=='defs') svg.removeChild(svg.lastChild)}
function drawNode(g,n){const group=document.createElementNS('http://www.w3.org/2000/svg','g');group.setAttribute('class','node '+n.type);const rect=document.createElementNS('http://www.w3.org/2000/svg','rect');rect.setAttribute('x',n.x);rect.setAttribute('y',n.y);rect.setAttribute('width',n.w);rect.setAttribute('height',n.h);group.appendChild(rect);const t=document.createElementNS('http://www.w3.org/2000/svg','text');t.setAttribute('x',n.x+n.w/2);t.setAttribute('y',n.y+n.h/2+4);t.setAttribute('text-anchor','middle');t.textContent=n.label;group.appendChild(t);g.appendChild(group)}
function link(g,a,b){const x1=a.x+a.w,y1=a.y+a.h/2,x2=b.x,y2=b.y+b.h/2,mx=(x1+x2)/2;const p=document.createElementNS('http://www.w3.org/2000/svg','path');p.setAttribute('d',`M ${x1} ${y1} C ${mx} ${y1}, ${mx} ${y2}, ${x2} ${y2}`);p.setAttribute('class','link');p.setAttribute('marker-end','url(#arrow)');g.appendChild(p)}
function normalize(n){return shared[n.id]?{...shared[n.id],id:n.id}:n}
function draw(flow){clearSVG();const g=document.createElementNS('http://www.w3.org/2000/svg','g');svg.appendChild(g);['SOA','RMS19','AZURE'].map(id=>({id,...shared[id]})).forEach(n=>drawNode(g,n));const map={'SOA':{...shared.SOA,id:'SOA'},'RMS19':{...shared.RMS19,id:'RMS19'},'AZURE':{...shared.AZURE,id:'AZURE'}};flows[flow].nodes.map(normalize).forEach(n=>{map[n.id]=n;drawNode(g,n)});[['SOA','RMS19'],['SOA','AZURE']].forEach(([a,b])=>link(g,map[a],map[b]));flows[flow].links.forEach(([a,b])=>link(g,map[a],map[b]))}

draw('SALES');
document.querySelectorAll('.menu button').forEach(btn=>btn.onclick=()=>{document.querySelectorAll('.menu button').forEach(b=>b.classList.remove('active'));btn.classList.add('active');draw(btn.dataset.flow)})
</script>
</body>
</html>
